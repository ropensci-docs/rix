<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>e - Using an IDE with Nix shells • rix</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="e - Using an IDE with Nix shells">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.15.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-getting-started.html">a - Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/b1-setting-up-and-using-rix-on-linux-and-windows.html">b1 - Setting up and using Nix and rix on Linux and Windows</a></li>
    <li><a class="dropdown-item" href="../articles/b2-setting-up-and-using-rix-on-macos.html">b2 - Setting up and using Nix and rix on macOS</a></li>
    <li><a class="dropdown-item" href="../articles/c-using-rix-to-build-project-specific-environments.html">c - Using rix to build project specific environments</a></li>
    <li><a class="dropdown-item" href="../articles/d1-installing-r-packages-in-a-nix-environment.html">d1 - Installing R packages in a Nix environment</a></li>
    <li><a class="dropdown-item" href="../articles/d2-installing-system-tools-and-texlive-packages-in-a-nix-environment.html">d2 - Installing system tools and TexLive packages in a Nix environment</a></li>
    <li><a class="dropdown-item" href="../articles/e-configuring-ide.html">e - Using an IDE with Nix shells</a></li>
    <li><a class="dropdown-item" href="../articles/f-renv2nix.html">f - Converting renv projects to Nix projects</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-building-an-environment-for-literate-programming.html">z - Advanced topic: Building an environment for literate programming</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-handling-packages-with-remote-dependencies.html">z - Advanced topic: Handling packages with remote dependencies</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-reproducible-analytical-pipelines-with-nix.html">z - Advanced topic: Reproducible Analytical Pipelines with Nix</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-running-r-or-shell-code-in-nix-from-r.html">z - Advanced topic: Running R or Shell Code in Nix from R</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-using-nix-inside-docker.html">z - Advanced topic: Using Nix inside Docker</a></li>
    <li><a class="dropdown-item" href="../articles/z-binary_cache.html">z - Advanced topic: Rolling out your own binary cache</a></li>
    <li><a class="dropdown-item" href="../articles/z-bleeding_edge.html">z - Advanced topic: Understanding the rPackages set release cycle and using bleeding edge packages</a></li>
    <li><a class="dropdown-item" href="../articles/z-contributing_to_nixpkgs.html">z - Advanced topic: Contributing to nixpkgs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/rix/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>e - Using an IDE with Nix shells</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rix/blob/master/vignettes/e-configuring-ide.Rmd" class="external-link"><code>vignettes/e-configuring-ide.Rmd</code></a></small>
      <div class="d-none name"><code>e-configuring-ide.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes interactive use of environments built with
<a href="https://docs.ropensci.org/rix/">rix</a> using an IDE (GUI editor) like RStudio. Depending on
your operating system and the editor you wish to use, different settings
must be configured.</p>
<p>It is also possible to evaluate single functions inside a dedicated,
separate, environment from another, main, interactive R session. For
more details regarding this, refer to the vignette
<code><a href="../articles/z-advanced-topic-running-r-or-shell-code-in-nix-from-r.html">vignette("z-advanced-topic-running-r-or-shell-code-in-nix-from-r")</a></code>.</p>
<div class="section level3">
<h3 id="our-recommendation">Our recommendation<a class="anchor" aria-label="anchor" href="#our-recommendation"></a>
</h3>
<p>The following are the setups we recommend you use to work using an
IDE and Nix environments. To be recommended, a setup should:</p>
<ul>
<li>be easy to setup;</li>
<li>work the same on any operating system;</li>
<li>not require any type of special maintenance.</li>
</ul>
<p>Regardless of your operating system, a general-purpose editor such as
VS Code (or Codium), Emacs, or Neovim meets the above requirements.
(Note: Neovim is not covered here due to lack of experience—PRs
welcome!) However, some editors perform better on certain platforms.</p>
<div class="section level4">
<h4 id="recommended-setup-on-macos">Recommended setup on macOS<a class="anchor" aria-label="anchor" href="#recommended-setup-on-macos"></a>
</h4>
<p>On macOS, RStudio will not be able to interact with Nix shells, so
you cannot use it. As such, we recommend either VS Code (or Codium) or
Positron. Emacs or Neovim are also good options. See the relevant
sections below to set up any of these editors. We also recommend to
install the editor on macOS directly, and configure it to interact with
Nix shells, instead of using Nix to install the editor, even though it
does take some more effort to configure.</p>
</div>
<div class="section level4">
<h4 id="recommended-setup-on-windows">Recommended setup on Windows<a class="anchor" aria-label="anchor" href="#recommended-setup-on-windows"></a>
</h4>
<p>On Windows, since you have to use Nix through WSL, your options are
limited to editors that either:</p>
<ul>
<li>can be installed on Windows and interact with WSL, or</li>
<li>can be launched directly from WSL.</li>
</ul>
<p>We recommend to use an editor you can install directly on Windows and
configure to interact nicely with WSL, and it turns out that this is
mostly only VS Code (or Codium). There are ways to configure Positron to
interact with WSL, but it requires significant effort and this is not
discussed here. See <a href="#configuring-native-vs-codecodium-on-your-operating-system">this
section</a> to learn how to configure VS Code (or Codium).</p>
<p>If you want to use RStudio or Positron, this is also possible
but:</p>
<ul>
<li>RStudio or Positron should ideally be installed with Nix inside
WSL;</li>
<li>your version of Windows needs to support <a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/gui-apps" class="external-link">WSLg</a>
which should be fine on Windows 11 or the very latest Windows 10 builds.
WSLg allows you to run GUI apps from WSL.</li>
</ul>
<p>However, be aware that there is a bug in WSLg that prevents modifier
keys like <a href="https://github.com/microsoft/wslg/issues/890" class="external-link">Alt
Gr</a> from working properly.</p>
<p>If you prefer Emacs or Neovim, then we recommend to install it in WSL
and use it in command line mode, not through WSLg (so starting Emacs
with the <code>- nw</code> argument).</p>
</div>
<div class="section level4">
<h4 id="recommended-setup-on-linux">Recommended setup on Linux<a class="anchor" aria-label="anchor" href="#recommended-setup-on-linux"></a>
</h4>
<p>On Linux distributions, the only real limitation is that RStudio
cannot interact with Nix shells (just like on the other operating
systems), so if you want to use RStudio then you need to install it
using Nix.</p>
<p>If you use another editor, just follow the relevant instructions
below; the question you need to think about is whether you want to use
Nix to install the editor inside of the development shell or if you
prefer to install your editor yourself using your distribution’s package
manager, and configure it to interact with Nix shells. We recommend the
latter option, regardless of the editor you choose.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="rstudio">RStudio<a class="anchor" aria-label="anchor" href="#rstudio"></a>
</h2>
<p>RStudio <strong>must</strong> be installed by Nix in order to
<em>see</em> and use Nix shells. So you cannot use the RStudio already
installed on your computer to work with Nix shells. This means you need
to set <code>ide = "rstudio"</code> if you wish to use RStudio.</p>
<div class="section level3">
<h3 id="rstudio-on-macos">RStudio on macOS<a class="anchor" aria-label="anchor" href="#rstudio-on-macos"></a>
</h3>
<p>As of writing, RStudio is not yet available for macOS through
Nixpkgs, which means that you cannot use RStudio to work with Nix
shells. <a href="https://github.com/NixOS/nixpkgs/pull/362637" class="external-link">There is
a draft PR that will introduce RStudio for macOS</a> though. As soon as
this PR is merged, it will become possible to use RStudio on macOS with
Nix shells. In the meantime, you might consider using <a href="#positron">Positron</a>.</p>
</div>
<div class="section level3">
<h3 id="rstudio-on-linux-or-windows">RStudio on Linux or Windows<a class="anchor" aria-label="anchor" href="#rstudio-on-linux-or-windows"></a>
</h3>
<p>To use RStudio on Linux or Windows simply use
<code>ide = "rstudio"</code>. Then, build the environment using
<code>nix-build</code> and drop into the shell using
<code>nix-shell</code>. Then, type <code>rstudio</code> to start
RStudio. On Windows, you need to have <code>WSLg</code> enabled, which
should be the case on the latest versions of Windows. If you wish, you
can even put the <code>rstudio</code> command in the shell hook to start
it immediately as you run <code>nix-shell</code>.</p>
<p>On Linux and WSL, depending on your desktop environment, you might
see the following error message when trying to launch RStudio:</p>
<pre><code>qt.glx: qglx_findConfig: Failed to finding matching FBConfig for QSurfaceFormat(version 2.0, options QFlags&lt;QSurfaceFormat::FormatOption&gt;(), depthBufferSize -1, redBufferSize 1, greenBufferSize 1, blueBufferSize 1, alphaBufferSize -1, stencilBufferSize -1, samples -1, swapBehavior QSurfaceFormat::SingleBuffer, swapInterval 1, colorSpace QSurfaceFormat::DefaultColorSpace, profile  QSurfaceFormat::NoProfile)
Could not initialize GLX
Aborted (core dumped)</code></pre>
<p>in this case, run the following before running RStudio:</p>
<pre><code>export QT_XCB_GL_INTEGRATION=none</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="positron">Positron<a class="anchor" aria-label="anchor" href="#positron"></a>
</h2>
<div class="section level3">
<h3 id="letting-nix-manage-positron">Letting Nix manage Positron<a class="anchor" aria-label="anchor" href="#letting-nix-manage-positron"></a>
</h3>
<p>If you want to install Positron with Nix, you need a call that looks
like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">...</span>,</span>
<span>  r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="co"># whatever packages you need</span></span>
<span>  ide <span class="op">=</span> <span class="st">"positron"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The advantage of letting Nix handle Positron is that you don’t need
to configure anything else. Simply build your environment using
<code>nix-build</code>, then activate the shell using
<code>nix-shell</code> and run <code>positron</code> to start using
Positron in the right environment (you can even put the
<code>positron</code> command in the shell hook to start it immediately
as you run <code>nix-shell</code>). Settings and extensions are shared
between all the different Positrons of all your different shells so you
don’t need to waste time reconfiguring different instances of Positron,
and Nix shells that use the same version of Positron will not install it
twice, but simply reuse it. However, if the version is slightly
different, then a new version will be installed.</p>
<p>To avoid having different versions of Positron installed on your
system, you can instead opt for the option where you install a single
Positron instance on your system and use it with all the Nix shells.</p>
</div>
<div class="section level3">
<h3 id="configuring-positron-installed-on-macos-to-interact-with-nix-shells">Configuring Positron installed on macOS to interact with Nix
shells<a class="anchor" aria-label="anchor" href="#configuring-positron-installed-on-macos-to-interact-with-nix-shells"></a>
</h3>
<p>If you prefer to use the Positron you have installed system-wide,
then generate environments by setting <code>ide = "none"</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">...</span>,</span>
<span>  r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  ide <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Start by installing Positron using the official <code>.dmg</code>
installer. Start Positron, and then the command palette using
<code>COMMAND-SHIFT-P</code>. In the search bar, type
<code>"Install 'positron' command in PATH"</code> and click on it: this
will make it possible to start Positron from a terminal. Quit Positron
completely. To use it with a Nix shell, open a terminal and navigate to
the project’s folder, then activate the shell using
<code>nix-shell</code> and now start Positron by typing
<code>positron</code>. In the top right corner of Positron, you will now
be able to select the R interpreter defined in the Nix shell.</p>
</div>
<div class="section level3">
<h3 id="configuring-positron-installed-on-linux-or-windows-to-interact-with-nix-shells">Configuring Positron installed on Linux or Windows to interact with
Nix shells<a class="anchor" aria-label="anchor" href="#configuring-positron-installed-on-linux-or-windows-to-interact-with-nix-shells"></a>
</h3>
<p>On Linux, simply install Positron using the installer (the
<code>.deb</code> or <code>.rpm</code> package depending on your
distribution) and on Windows <strong>DO NOT INSTALL</strong> Positron
using the Windows installer! You need to install Positron in your WSL
distribution. Assuming your distribution is Ubuntu, download
<code>.deb</code> package and put it in a folder in your WSL
distribution, or run the following from line from Ubuntu (change
Positron’s version to whatever is current):</p>
<pre><code>wget https://github.com/posit-dev/positron/releases/download/2025.02.0-137/Positron-2025.02.0-137-x64.deb</code></pre>
<p>then run:</p>
<pre><code>sudo dpkg -i Positron-2025.02.0-137-x64.deb</code></pre>
<p>This will install Positron in WSL.</p>
<p>Then, navigate to your project’s folder and start the Nix shell using
<code>nix-shell</code> and then Positron by typing
<code>positron</code>. On Linux, this will start your system-level
Positron, on Windows, this will start the WSL Positron using WSLg. That
WSL Positron is available for any Nix shells from WSL.</p>
</div>
</div>
<div class="section level2">
<h2 id="vs-codecodium">VS Code/Codium<a class="anchor" aria-label="anchor" href="#vs-codecodium"></a>
</h2>
<p>You can use VS Code or Codium (henceforth, I’ll refer to both these
editors simply as “Code”) with Nix shells by either installing it
through Nix (so by setting <code>ide = "code"</code> or
<code>ide = "codium"</code>) or by installing it on your operating
system and then configure it to be able to interact with Nix shells. In
any case, you will need to install the <a href="https://github.com/REditorSupport/languageserver/" class="external-link">languageserver</a> R
package for Code to interact properly with the R console.</p>
<p>Settings and extensions are shared between all the different Codes of
all your different shells so you don’t need to waste time reconfiguring
different instances of Code, and Nix shells that use the same version of
Code will not install it twice, but simply reuse it. However, if the
version is slightly different, then a new version will be installed.</p>
<p>To avoid having different versions of Code installed on your system,
you can instead opt for the option where you install Code for your
system using the usual installation method (so an installer for Windows
or macOS, through your operating system’s package manager for any Linux
distribution), and instead configure it to interact with Nix shells.</p>
<p>If you’re on Windows, using Code like this is particularly
interesting, because it allows you to install Code on Windows as usual,
and then you can configure it to interact with a Nix shell, even if it’s
running from WSL. This is a very seamless experience.</p>
<div class="section level3">
<h3 id="letting-nix-manage-vs-codecodium">Letting Nix manage VS Code/Codium<a class="anchor" aria-label="anchor" href="#letting-nix-manage-vs-codecodium"></a>
</h3>
<p>So, concretely, if you want to install Code with Nix, you need a call
that looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">...</span>,</span>
<span>  r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"languageserver"</span>, <span class="va">...</span><span class="op">)</span>, <span class="co"># languageserver is needed</span></span>
<span>  ide <span class="op">=</span> <span class="st">"code"</span>, <span class="co"># or "codium"</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Or if you prefer to use the Code you have installed system-wide,
then:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">...</span>,</span>
<span>  r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"languageserver"</span>, <span class="va">...</span><span class="op">)</span>, <span class="co"># languageserver is needed</span></span>
<span>  ide <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The advantage of letting Nix handle Code is that you don’t need to
configure anything else. Simply build your environment using
<code>nix-build</code>, then activate the shell using
<code>nix-shell</code> and run <code>code</code> (for VS Code) or
<code>codium</code> (for Codium). You can even put the <code>code</code>
(or <code>codium</code>) command in the shell hook argument to have it
start as soon as you drop in the development shell using
<code>nix-shell</code>.</p>
</div>
<div class="section level3">
<h3 id="configuring-native-vs-codecodium-on-your-operating-system">Configuring native VS Code/Codium on your operating system<a class="anchor" aria-label="anchor" href="#configuring-native-vs-codecodium-on-your-operating-system"></a>
</h3>
<p>The same instructions apply whether your host operating system is
Linux, macOS or Windows. The first step is of course to install Code on
your operating system using the usual means of installing software.</p>
<p>If you’re on Windows, install Code on Windows, not in WSL. Code on
Windows is able to interact with WSL seamlessly and before continuing
here, please follow <a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-vscode" class="external-link">these
instructions</a>.</p>
<p>Then, you need to install a piece of software called
<code>direnv</code>: <code>direnv</code> will automatically load Nix
shells when you open a project that contains a <code>default.nix</code>
file in an editor. It works on any operating system and many editors
support it, including Code. Follow the instructions for your operating
system <a href="https://direnv.net/docs/installation.html" class="external-link">here</a> but
if you’re using Windows, install <code>direnv</code> in WSL, so follow
the instructions for whatever Linux distribution you’re using there
(likely Ubuntu), or use Nix to install <code>direnv</code> if you prefer
(this is the way I recommend to install it on macOS, unless you already
use <code>brew</code>):</p>
<pre><code>nix-env -f '&lt;nixpkgs&gt;' -iA direnv</code></pre>
<p>This will install <code>direnv</code> and make it available even
outside of Nix shells!</p>
<p>Then, in Code, install the <a href="https://github.com/direnv/direnv-vscode" class="external-link">direnv</a> extension (and
also the WSL extension if you’re on Windows, as explained in the
official documentation linked above!). Finally, add a file called
<code>.envrc</code> and simply write <code>use nix</code> in it. Now,
open the project’s folder using <code>File &gt; Open Folder...</code>
and you will see a pop-up stating
<code>direnv: /PATH/TO/PROJECT/.envrc is blocked</code> and a button to
allow it. Click <code>Allow</code> and then open an R script. You might
get another pop-up asking you to restart the extension, so click
<code>Restart</code>. Be aware that at this point, <code>direnv</code>
will run <code>nix-shell</code> and so will start building the
environment. If that particular environment hasn’t been built and cached
yet, it might take some time before Code will be able to interact with
it. You might get yet another popup, this time from the R Code extension
complaining that R can’t be found. In this case, simply restart Code and
open the project folder again: now it should work every time. For a new
project, simply repeat this process:</p>
<ul>
<li>Generate the project’s <code>default.nix</code> file;</li>
<li>Build it using <code>nix-build</code>;</li>
<li>Create an <code>.envrc</code> and write <code>use nix</code> in
it;</li>
<li>Open the project’s folder in Code and click allow when
prompted;</li>
<li>Restart the extension and Code if necessary.</li>
</ul>
<p>Another option is to create the <code>.envrc</code> file and write
<code>use nix</code> in it, then open a terminal, navigate to the
project’s folder, and run <code>direnv allow</code>. Doing this before
open Code should not prompt you anymore.</p>
</div>
</div>
<div class="section level2">
<h2 id="emacs">Emacs<a class="anchor" aria-label="anchor" href="#emacs"></a>
</h2>
<div class="section level3">
<h3 id="letting-nix-manage-emacs">Letting Nix manage Emacs<a class="anchor" aria-label="anchor" href="#letting-nix-manage-emacs"></a>
</h3>
<p>Emacs can be installed through Nix, but is not an option of the
<code>ide</code> argument. This is because there are several versions of
Emacs available through Nix (find these versions <a href="https://search.nixos.org/packages?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=emacs" class="external-link">here</a>)
so install whatever version you want by putting it in
<code>system_pkgs</code> like so:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">...</span>,</span>
<span>  r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="co"># whatever packages you need</span></span>
<span>  system_pkgs <span class="op">=</span> <span class="st">"emacs"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This doesn’t require any further configuration to use. Simply drop in
the Nix shell using <code>nix-shell</code> and type <code>emacs</code>.
You can set the <code>emacs</code> command as the shell hook so Emacs
starts automatically upon entering the shell. On Windows, if WSLg is
enabled, it’ll start Emacs from WSL, if not, it’ll start it as a
terminal application. we recommend using Emacs as a terminal application
instead of through WSLg, as there is a bug in WSLg that prevents
modifier keys like <a href="https://github.com/microsoft/wslg/issues/890" class="external-link">AltGr</a> from
working properly. This is quite problematic with Emacs, so we recommend
using it in cli mode using <code>emacs -nw</code>.</p>
</div>
<div class="section level3">
<h3 id="configuring-native-emacs-on-your-operating-system">Configuring native Emacs on your operating system<a class="anchor" aria-label="anchor" href="#configuring-native-emacs-on-your-operating-system"></a>
</h3>
<p>You can install Emacs on Linux and macOS and configure it to interact
with Nix shells. Install Emacs using the usual means of installing
software on your operating system. On Windows you cannot use the native
Emacs installed on Windows to interact with WSL, so you will need to
install Emacs on WSL. If your WSL distribution is Ubuntu (which it
likely is), you can install Emacs with:</p>
<pre><code>sudo apt update
sudo apt install -y emacs</code></pre>
<p>Because you’re using the Emacs from your operating system, generate
<code>default.nix</code> shells by setting
<code>ide = "other"</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">...</span>,</span>
<span>  r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="co"># whatever packages you need</span></span>
<span>  ide <span class="op">=</span> <span class="st">"other"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then, you need to install a piece of software called
<code>direnv</code>: <code>direnv</code> will automatically load Nix
shells when you open a project that contains a <code>default.nix</code>
file in an editor. It works on any operating system and many editors
support it, including Emacs. Follow the instructions for your operating
system <a href="https://direnv.net/docs/installation.html" class="external-link">here</a> but
if you’re using Windows, install <code>direnv</code> in WSL, so follow
the instructions for whatever Linux distribution you’re using there
(likely Ubuntu), or use Nix to install <code>direnv</code> if you prefer
(this is the way I recommend to install it on macOS, unless you already
use <code>brew</code>):</p>
<pre><code>nix-env -f '&lt;nixpkgs&gt;' -iA direnv</code></pre>
<p>This will install <code>direnv</code> and make it available even
outside of Nix shells!</p>
<p>Then install the Emacs <code>direnv</code> <a href="https://github.com/wbolster/emacs-direnv" class="external-link">package</a>. Finally,
add a file called <code>.envrc</code> and simply write
<code>use nix</code> in it. Now, open the project’s folder in a terminal
and type <code>direnv allow</code>. Be aware that at this point,
<code>direnv</code> will run <code>nix-shell</code> and so will start
building the environment. If that particular environment hasn’t been
built and cached yet, it might take some time. Starting Emacs and
loading a script from that folder will now load the environment for you
automatically. On Windows, starting Emacs from WSL will start the Linux
GUI version using WSLg. As mentioned in the introduction, be aware that
there is a bug in WSLg that prevents modifier keys like <a href="https://github.com/microsoft/wslg/issues/890" class="external-link">Alt Gr</a> from
working properly. This is quite problematic with Emacs, so we recommend
using it in cli mode using <code>emacs -nw</code>.</p>
<p>For a new project, simply repeat this process:</p>
<ul>
<li>Generate the project’s <code>default.nix</code> file;</li>
<li>Build it using <code>nix-build</code>;</li>
<li>Create an <code>.envrc</code> and write <code>use nix</code> in
it;</li>
<li>Open the project’s folder in a terminal and run
<code>direnv allow</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="making-a-launcher-to-start-your-editor">Making a launcher to start your editor<a class="anchor" aria-label="anchor" href="#making-a-launcher-to-start-your-editor"></a>
</h2>
<p>If you don’t use <code>direnv</code> to automatically load the Nix
shell with your editor, you can also create a launcher using
<code>rix::make_launcher("rstudio")</code> (change
<code>"rstudio"</code> to whichever command starts your editor). This
will create a script called <code>start-EDITOR.sh</code> where
<code>EDITOR</code> will be replaced by what you used before.</p>
<p>The contents of the script are the following:</p>
<pre><code><span><span class="co">#!/usr/bin/env nix-shell</span></span>
<span><span class="co">#!nix-shell default.nix -i bash</span></span>
<span><span class="va">EDITOR</span></span></code></pre>
<p>Give this script execution rights (by using
<code>chmod +x start-EDITOR.sh</code> in a terminal) and you’ll be able
to start your editor in the right environment by either clicking on it,
or by running <code>./start-EDITOR.sh</code> in the terminal.</p>
<p>(On Linux, if you use RStudio, and only if needed, add the
<code>export QT_XCB_GL_INTEGRATION=none</code> line before
<code>rstudio</code>).</p>
<p>You can also define a shortcut to a project that will take care of
activating the environment and launching your editor. This way, you
don’t need to start a terminal in that folder and drop into the Nix
environment each time you want to work on this project. For example, you
could define a bash alias like this:</p>
<pre><code>alias kmeans='nix-shell ~/Documents/kmeans/default.nix --run rstudio</code></pre>
<p>which would then execute RStudio in the right project by simply
typing <code>kmeans</code> in a terminal for your project that uses the
K-means algorithm.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
