<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>f - Converting renv projects to Nix projects • rix</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="f - Converting renv projects to Nix projects">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.15.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-getting-started.html">a - Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/b1-setting-up-and-using-rix-on-linux-and-windows.html">b1 - Setting up and using Nix and rix on Linux and Windows</a></li>
    <li><a class="dropdown-item" href="../articles/b2-setting-up-and-using-rix-on-macos.html">b2 - Setting up and using Nix and rix on macOS</a></li>
    <li><a class="dropdown-item" href="../articles/c-using-rix-to-build-project-specific-environments.html">c - Using rix to build project specific environments</a></li>
    <li><a class="dropdown-item" href="../articles/d1-installing-r-packages-in-a-nix-environment.html">d1 - Installing R packages in a Nix environment</a></li>
    <li><a class="dropdown-item" href="../articles/d2-installing-system-tools-and-texlive-packages-in-a-nix-environment.html">d2 - Installing system tools and TexLive packages in a Nix environment</a></li>
    <li><a class="dropdown-item" href="../articles/e-configuring-ide.html">e - Using an IDE with Nix shells</a></li>
    <li><a class="dropdown-item" href="../articles/f-renv2nix.html">f - Converting renv projects to Nix projects</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-building-an-environment-for-literate-programming.html">z - Advanced topic: Building an environment for literate programming</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-handling-packages-with-remote-dependencies.html">z - Advanced topic: Handling packages with remote dependencies</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-reproducible-analytical-pipelines-with-nix.html">z - Advanced topic: Reproducible Analytical Pipelines with Nix</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-running-r-or-shell-code-in-nix-from-r.html">z - Advanced topic: Running R or Shell Code in Nix from R</a></li>
    <li><a class="dropdown-item" href="../articles/z-advanced-topic-using-nix-inside-docker.html">z - Advanced topic: Using Nix inside Docker</a></li>
    <li><a class="dropdown-item" href="../articles/z-binary_cache.html">z - Advanced topic: Rolling out your own binary cache</a></li>
    <li><a class="dropdown-item" href="../articles/z-bleeding_edge.html">z - Advanced topic: Understanding the rPackages set release cycle and using bleeding edge packages</a></li>
    <li><a class="dropdown-item" href="../articles/z-contributing_to_nixpkgs.html">z - Advanced topic: Contributing to nixpkgs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/rix/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>f - Converting renv projects to Nix projects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rix/blob/master/vignettes/f-renv2nix.Rmd" class="external-link"><code>vignettes/f-renv2nix.Rmd</code></a></small>
      <div class="d-none name"><code>f-renv2nix.Rmd</code></div>
    </div>

    
    
<p><em>renv2nix() is early development stages and its arguments may
change in the future</em></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="https://rstudio.github.io/renv/" class="external-link">renv</a> is very likely the most popular package for
reproducibility in R. <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> generates and manages
so-called <code>renv.lock</code> files at the level of a project, and
using these files it is thus possible to have different versions of the
same packages on the same system, without any interference. However,
<a href="https://rstudio.github.io/renv/" class="external-link">renv</a> doesn’t snapshot R itself, so different projects
with different libraries of packages will end up using the same version
of R, which could lead to issues, especially if you’re trying to restore
an old project which relied on an old version of R. Also, in some cases,
it might be impossible to restore a project due to incompatibilities at
the level of the system-level dependencies, as these are not managed by
<a href="https://rstudio.github.io/renv/" class="external-link">renv</a>. In our experience, the older the project, the less
likely restoring it using <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> will succeed.</p>
<p>As explained extensively in this documentation already, Nix handles
all the different pieces of the reproducibility puzzle: versions of R
packages, versions of R, and versions of system-level dependencies are
all handled by Nix. In other words, it’s possible to have per project
complete development environments that are completely reproducible.</p>
<p>While Nix has been around for 20 years, it was never widely adopted
by R users, who instead have already invested a lot of effort into
<a href="https://rstudio.github.io/renv/" class="external-link">renv</a> and Docker. The goal of <a href="https://docs.ropensci.org/rix/">rix</a> is to
ease adoption of Nix for R users for new projects, but there is also a
need to convert historical <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> projects into Nix.</p>
<p>This is where <code><a href="../reference/renv2nix.html">renv2nix()</a></code> can help.</p>
</div>
<div class="section level2">
<h2 id="converting-an-historical-renv-project">Converting an historical renv project<a class="anchor" aria-label="anchor" href="#converting-an-historical-renv-project"></a>
</h2>
<p>There are two ways that you can convert an historical project: the
recommended way is to copy the historical <code>renv.lock</code> file
into a new, empty folder. Do not copy any of the other generated
<a href="https://rstudio.github.io/renv/" class="external-link">renv</a> files nor folders. From there, call
<code><a href="../reference/renv2nix.html">renv2nix()</a></code> like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/renv2nix.html">renv2nix</a></span><span class="op">(</span></span>
<span>  renv_lock_path <span class="op">=</span> <span class="st">"path/to/rix_project/renv.lock"</span>,</span>
<span>  project_path <span class="op">=</span> <span class="st">"path/to/rix_project"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will generate a <code>default.nix</code> and
<code>.Rprofile</code> files for your Nix project.</p>
<p>The other way to achieve this is to point the
<code>renv_lock_path</code> argument to the historical
<code>renv.lock</code> file without copying it to a new folder:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/renv2nix.html">renv2nix</a></span><span class="op">(</span></span>
<span>  renv_lock_path <span class="op">=</span> <span class="st">"path/to/original/renv_project/renv.lock"</span>,</span>
<span>  project_path <span class="op">=</span> <span class="st">"path/to/rix_project"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>But this is not the recommended approach. Instead keep the original
<code>renv.lock</code> file and the generated <code>default.nix</code>
files together (ideally with the call to <code><a href="../reference/renv2nix.html">renv2nix()</a></code> in an R
script) and commit everything into version control.</p>
</div>
<div class="section level2">
<h2 id="starting-a-new-project">Starting a new project<a class="anchor" aria-label="anchor" href="#starting-a-new-project"></a>
</h2>
<p>If you start a new project, you don’t need to use
<code><a href="../reference/renv2nix.html">renv2nix()</a></code>, as you could directly use <code><a href="../reference/rix.html">rix()</a></code> to
generate a <code>default.nix</code> file. However, you could start with
generating an <code>renv.lock</code> file using
<code>renv::snapshot()</code> and then call <code><a href="../reference/renv2nix.html">renv2nix()</a></code>, to
generate the appropriate <code>default.nix</code> file. Because
<code>renv::snapshot()</code> does not call <code>renv::init()</code>
this will not generate any other files that could interfere with
<a href="https://docs.ropensci.org/rix/">rix</a>. Doing this could be useful if you have the habit of
starting writing code and then would like to generate a
<code>default.nix</code> file later. We don’t recommend working like
this and instead urge you to start from an environment and work from the
very beginning from that environment.</p>
</div>
<div class="section level2">
<h2 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h2>
<div class="section level3">
<h3 id="package-versions-are-not-exactly-the-same-between-the-renv-lock-and-default-nix-files">Package versions are not exactly the same between the renv.lock and
default.nix files<a class="anchor" aria-label="anchor" href="#package-versions-are-not-exactly-the-same-between-the-renv-lock-and-default-nix-files"></a>
</h3>
<p><code><a href="../reference/renv2nix.html">renv2nix()</a></code> has two methods, <code>"fast"</code> and
<code>"accurate"</code>. <code>"fast"</code> simply lists the version of
R and R packages, and generates a <code>default.nix</code> expression
without trying to match package versions exactly. We believe that this
is acceptable for most use cases. The planned <code>"accurate"</code>
method will instead try to do its best to match exact package versions.
However, due to how differently Nix and <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> handle
snapshotting, it will not be possible to match package versions exactly
even with the planned <code>"accurate"</code> method. If you absolutely
need a very specific version of a package, there are other ways to
achieve this, by providing for example the required version to the
<code>r_pkgs</code> argument of <code><a href="../reference/rix.html">rix()</a></code>, like this:
<code>rix(r_pkgs = "dplyr@0.8.0")</code>. This however tries to build
the pacage from source, which can fail. If this is the case, don’t
hesitate to open an issue. Better handling of individual package
versions is planned for a future release.</p>
</div>
<div class="section level3">
<h3 id="dont-use-the-same-folder-for-your-nix-and-renv-projects">Don’t use the same folder for your Nix and {renv} projects<a class="anchor" aria-label="anchor" href="#dont-use-the-same-folder-for-your-nix-and-renv-projects"></a>
</h3>
<p>As stated previously, don’t convert an <code>renv.lock</code> file
into a <code>default.nix</code> file from a folder that contains the
<code>renv.lock</code> file and the <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> generated
<code>.Rprofile</code> file and <code>renv/</code> folder. Instead, work
from a new empty folder in which you copy the <code>renv.lock</code>
file.</p>
</div>
<div class="section level3">
<h3 id="mind-the-r-version">Mind the R version<a class="anchor" aria-label="anchor" href="#mind-the-r-version"></a>
</h3>
<p>Many R users do not update R very often, so when they generate an
<code>renv.lock</code> file, the <code>renv.lock</code> will list an old
version of R, but potentially very recent packages. The way
<a href="https://docs.ropensci.org/rix/">rix</a> generates <code>default.nix</code> files is by
looking at the version of R and then install packages that were current
at that time. So if the <code>renv.lock</code> file lists an old version
of R, the packages that will be included in the <code>default.nix</code>
file will also be old. You could even end up in a situation where a
package is not available because it only recently got released on CRAN.
To avoid problems, use the <code>override_r_ver</code> argument of
<code><a href="../reference/renv2nix.html">renv2nix()</a></code> to provide a more recent version of R, that
matches roughly when the packages were released.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
